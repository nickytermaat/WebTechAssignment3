/**
 * Created by Kris on 9/28/2016.
 */
var express = require('express');
var app = express();
var bodyParser = require('body-parser');
var mongoose = require('mongoose');
var jwt = require('jsonwebtoken');

//Connect to the database
mongoose.connect('mongodb://localhost/test');
var Schema = mongoose.Schema;
var movieResource = require('../resources/moviesResource.js');
//Register bodyparser
app.use(bodyParser.urlencoded({extended: true}));
app.use(bodyParser.json());

//Set and start the server
var Server =
    app.listen(3000, function(){
        console.log("Example app on port " + Server.address().port);
        // user1.save(function(err, result){
        //     if(err){
        //         return console.error(err);
        //     }
        // });
        console.log("Server started..");
    });

app.get('/list', function(req, res){
    var token = req.headers['authorization'];

    jwt.verify(token, "Thisismysecretkey", function(error, decoded){
        if(error){
            res.send(error);
            //Send error code
        } else {
            res.send("Hoi");
            //Something went wrong
            //Do something with the decoded parameter
        }
    })
});

var userResource = require('../resources/userResource.js');
app.post('/api/getToken', userResource.authenticate);
app.get('/api/getUser/:name', userResource.getUser);
app.get('/api/getUser', userResource.getAllUsers);
app.post('/api/addMovie', movieResource.addMovie);
app.post('/api/register', userResource.addUser);
app.get('/api/movies/:ttNumber', movieResource.getMovie);
app.get('/api/movies',  movieResource.getAllMovies);


//TODO: ADD PERSON
// var addPersonResource = function(req, res); //Set require here
// app.post('/api/registerUser', function(req, res){
//     addPersonResource(req,res);
// });

// var getPersonResource = function(req, res);
// app.get('/api/users', function(req, res){
//     var token = req.headers['authorization'];
//     jwt.verify(token, "thisismysecretkey", function(error, decoded){
//         if(error){
//             res.send(error);
//         } else {
//             res.send(User.find());
//         }
//     });
// });
